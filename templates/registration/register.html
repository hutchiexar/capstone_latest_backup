{% extends 'base.html' %}
{% load static %}

{% block content_no_sidebar %}
<div class="container">
    <div class="row justify-content-center align-items-center min-vh-100 py-5">
        <div class="col-xl-10 col-lg-11">
            <div class="card shadow-lg border-0 rounded-4 registration-card">
                <!-- Logo and Title Section -->
                <div class="card-header bg-white text-center border-0 pt-4 pb-2">
                    <img src="{% static 'admin/img/logo.ico' %}" alt="Logo" class="mb-3" style="width: 60px;">
                    <h3 class="fw-bold text-primary mb-1">Create Your Account</h3>
                    <p class="text-muted">Join CTTMO Traffic Violation Management System</p>
                </div>

                <!-- Progress Bar -->
                <div class="px-4">
                    <div class="progress" style="height: 4px;">
                        <div class="progress-bar" role="progressbar" style="width: 0%;" id="formProgress"></div>
                    </div>
                </div>

                <div class="card-body p-4 p-lg-5">
                    <form method="post" enctype="multipart/form-data" id="registrationForm" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <div class="row g-4">
                            <!-- Personal Information -->
                            <div class="col-md-6">
                                <div class="section-card p-4 h-100">
                                    <div class="d-flex align-items-center mb-4">
                                        <span class="material-icons text-primary me-2">person</span>
                                        <h5 class="mb-0">Personal Information</h5>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="first_name" class="form-label">First Name</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">badge</i></span>
                                            <input type="text" class="form-control" id="first_name" name="first_name" required>
                                            <div class="invalid-feedback">Please enter your first name.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="last_name" class="form-label">Last Name</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">badge</i></span>
                                            <input type="text" class="form-control" id="last_name" name="last_name" required>
                                            <div class="invalid-feedback">Please enter your last name.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="email" class="form-label">Email Address</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">email</i></span>
                                            <input type="email" class="form-control" id="email" name="email" required>
                                            <div class="invalid-feedback">Please enter a valid email address.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="phone_number" class="form-label">Phone Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">phone</i></span>
                                            <input type="tel" class="form-control" id="phone_number" name="phone_number" 
                                                   pattern="[0-9]{11}" placeholder="09XXXXXXXXX" required>
                                            <div class="invalid-feedback">Please enter a valid phone number (11 digits).</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Account Information -->
                            <div class="col-md-6">
                                <div class="section-card p-4 h-100">
                                    <div class="d-flex align-items-center mb-4">
                                        <span class="material-icons text-primary me-2">lock</span>
                                        <h5 class="mb-0">Account Information</h5>
                                    </div>

                                    <div class="mb-3">
                                        <label for="username" class="form-label">Username</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">account_circle</i></span>
                                            <input type="text" class="form-control" id="username" name="username" required>
                                            <div class="invalid-feedback">Please choose a username.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="password" class="form-label">Password</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">lock</i></span>
                                            <input type="password" class="form-control" id="password" name="password" 
                                                   required pattern="^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$">
                                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                <i class="material-icons">visibility</i>
                                            </button>
                                            <div class="invalid-feedback">Password must be at least 8 characters long and include letters and numbers.</div>
                                        </div>
                                        <!-- Password Strength Indicator -->
                                        <div class="password-strength mt-2" id="passwordStrength">
                                            <div class="progress" style="height: 5px;">
                                                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                                            </div>
                                            <small class="text-muted mt-1 d-block">Password strength: <span id="strengthText">None</span></small>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="confirm_password" class="form-label">Confirm Password</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">lock_clock</i></span>
                                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                                            <div class="invalid-feedback">Passwords do not match.</div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label for="license_number" class="form-label">License Number</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="material-icons">credit_card</i></span>
                                            <input type="text" class="form-control" id="license_number" name="license_number" 
                                                   pattern="[A-Z0-9-]+" required>
                                            <div class="invalid-feedback">Please enter a valid license number.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Information -->
                            <div class="col-12">
                                <div class="section-card p-4">
                                    <div class="d-flex align-items-center mb-4">
                                        <span class="material-icons text-primary me-2">location_on</span>
                                        <h5 class="mb-0">Additional Information</h5>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-8">
                                            <div class="mb-3">
                                                <label for="address" class="form-label">Complete Address</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><i class="material-icons">home</i></span>
                                                    <textarea class="form-control" id="address" name="address" rows="3" required></textarea>
                                                    <div class="invalid-feedback">Please enter your complete address.</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="avatar" class="form-label">Profile Picture</label>
                                                <div class="avatar-upload">
                                                    <div class="avatar-preview mb-3">
                                                        <div class="avatar-preview-inner">
                                                            <div class="empty-state" id="emptyState">
                                                                <i class="material-icons">account_circle</i>
                                                                <span>No photo selected</span>
                                                            </div>
                                                            <img id="avatarPreview" src="" alt="Avatar Preview" style="display: none;">
                                                        </div>
                                                    </div>
                                                    <div class="input-group">
                                                        <span class="input-group-text"><i class="material-icons">add_a_photo</i></span>
                                                        <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*">
                                                    </div>
                                                    <div class="upload-hints mt-2">
                                                        <small class="text-muted d-block">Recommended: Square image, max 5MB</small>
                                                        <small class="text-muted d-block">Supported formats: JPG, PNG, GIF</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="mt-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="termsCheck" required>
                                <label class="form-check-label" for="termsCheck">
                                    I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms and Conditions</a>
                                </label>
                                <div class="invalid-feedback">You must agree to the terms and conditions.</div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between align-items-center mt-4">
                            <a href="{% url 'login' %}" class="btn btn-link text-muted text-decoration-none">
                                <i class="material-icons align-middle me-1">arrow_back</i> Back to Login
                            </a>
                            <button type="submit" class="btn btn-primary px-4 py-2">
                                Create Account <i class="material-icons align-middle ms-1">arrow_forward</i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms and Conditions Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Terms and Conditions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- Add your terms and conditions content here -->
                <h6>1. Account Registration</h6>
                <p>By registering for an account with CTTMO Traffic Violation Management System, you agree to provide accurate and complete information.</p>
                
                <h6>2. Privacy Policy</h6>
                <p>Your personal information will be handled in accordance with our privacy policy and data protection regulations.</p>
                
                <h6>3. User Responsibilities</h6>
                <p>You are responsible for maintaining the confidentiality of your account credentials and for all activities under your account.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Custom Styles -->
<style>
    .registration-card {
        background: #fff;
        border: none;
    }

    .section-card {
        background: #f8f9fa;
        border-radius: 12px;
        transition: all 0.3s ease;
    }

    .section-card:hover {
        background: #fff;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.08);
    }

    .input-group-text {
        background: transparent;
        border-right: none;
    }

    .input-group-text i {
        font-size: 1.2rem;
        color: #6c757d;
    }

    .input-group .form-control {
        border-left: none;
    }

    .input-group .form-control:focus {
        border-color: #dee2e6;
        box-shadow: none;
    }

    .input-group:focus-within {
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        border-radius: 0.375rem;
    }

    .avatar-preview {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        overflow: hidden;
        margin: 0 auto;
        border: 3px solid #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        background-color: #f8f9fa;
        position: relative;
    }

    .avatar-preview-inner {
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
        transition: all 0.3s ease;
    }

    .empty-state {
        text-align: center;
        color: #6c757d;
        padding: 1rem;
    }

    .empty-state i {
        font-size: 3rem;
        margin-bottom: 0.5rem;
        display: block;
    }

    .empty-state span {
        font-size: 0.8rem;
        display: block;
    }

    .avatar-preview img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: all 0.3s ease;
    }

    .avatar-upload:hover .avatar-preview {
        border-color: var(--primary-color);
    }

    .upload-hints small {
        font-size: 0.75rem;
        line-height: 1.4;
    }

    .avatar-preview::after {
        content: 'Change Photo';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        font-size: 0.75rem;
        padding: 0.25rem;
        text-align: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .avatar-preview:hover::after {
        opacity: 1;
    }

    .progress {
        border-radius: 10px;
        height: 6px !important;
    }

    .password-strength .progress-bar {
        transition: width 0.3s ease;
    }

    /* Custom form validation styles */
    .was-validated .form-control:valid, .form-control.is-valid {
        border-color: #198754;
        background-image: none;
    }

    .was-validated .form-control:invalid, .form-control.is-invalid {
        border-color: #dc3545;
        background-image: none;
    }

    .form-control:focus {
        box-shadow: none;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .card-body {
            padding: 1.5rem !important;
        }
        
        .section-card {
            padding: 1rem !important;
        }
    }
</style>

<!-- Custom Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registrationForm');
    const password = document.getElementById('password');
    const confirmPassword = document.getElementById('confirm_password');
    const togglePassword = document.getElementById('togglePassword');
    const progressBar = document.getElementById('formProgress');
    const avatarInput = document.getElementById('avatar');
    const avatarPreview = document.getElementById('avatarPreview');

    // Form validation
    form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    });

    // Password visibility toggle
    togglePassword.addEventListener('click', function() {
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);
        this.querySelector('i').textContent = type === 'password' ? 'visibility' : 'visibility_off';
    });

    // Password strength indicator
    password.addEventListener('input', function() {
        const strength = calculatePasswordStrength(this.value);
        updatePasswordStrength(strength);
    });

    // Confirm password validation
    confirmPassword.addEventListener('input', function() {
        if (this.value !== password.value) {
            this.setCustomValidity('Passwords do not match');
        } else {
            this.setCustomValidity('');
        }
    });

    // Form progress calculation
    const formInputs = form.querySelectorAll('input[required], textarea[required]');
    formInputs.forEach(input => {
        input.addEventListener('input', updateProgress);
    });

    // Avatar preview
    avatarInput.addEventListener('change', function() {
        const emptyState = document.getElementById('emptyState');
        const preview = document.getElementById('avatarPreview');
        
        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                emptyState.style.display = 'none';
            };
            reader.readAsDataURL(this.files[0]);
        } else {
            preview.style.display = 'none';
            emptyState.style.display = 'block';
        }
    });

    // Helper functions
    function calculatePasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength += 25;
        if (password.match(/[A-Z]/)) strength += 25;
        if (password.match(/[0-9]/)) strength += 25;
        if (password.match(/[^A-Za-z0-9]/)) strength += 25;
        return strength;
    }

    function updatePasswordStrength(strength) {
        const progressBar = document.querySelector('#passwordStrength .progress-bar');
        const strengthText = document.getElementById('strengthText');
        
        progressBar.style.width = strength + '%';
        
        if (strength <= 25) {
            progressBar.className = 'progress-bar bg-danger';
            strengthText.textContent = 'Weak';
        } else if (strength <= 50) {
            progressBar.className = 'progress-bar bg-warning';
            strengthText.textContent = 'Fair';
        } else if (strength <= 75) {
            progressBar.className = 'progress-bar bg-info';
            strengthText.textContent = 'Good';
        } else {
            progressBar.className = 'progress-bar bg-success';
            strengthText.textContent = 'Strong';
        }
    }

    function updateProgress() {
        const totalFields = formInputs.length;
        let filledFields = 0;
        
        formInputs.forEach(input => {
            if (input.value.trim() !== '') filledFields++;
        });

        const progress = (filledFields / totalFields) * 100;
        progressBar.style.width = progress + '%';
    }
});
</script>
{% endblock %} 